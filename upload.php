<html>
	<head>
		<title>Secret government kitty photos</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	</head>
		<?php
			session_start(); //starts the session
			$loggedin = FALSE;
			if(isset($_SESSION['user'])){ //checks if user is logged in
				$loggedin = TRUE;
				$user = $_SESSION['user']; //assigns user value
			}
			else{
				header('location: index.php');
			}
		?>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<a class="navbar-brand" href="index.php">SGKP</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="index.php">Home </a>
					</li>
					<?php 
						if ($loggedin) {
							print '<li class="nav-item">
									<a class="nav-link" href="upload.php">Upload Images</a>
									</li>';
						}
					?>
				</ul>

				<ul class="navbar-nav">
				<?php 
					if ($loggedin) {
						print '<li class="nav-item mr-5" style="color: white;"><b>
									Hello ' . $user . ' </b>
								</li>
								<li class="nav-item mr-5">
									<a href="logout.php">Logout</a>
								</li>';
					}
					else {
						print '<li class="nav-item mr-5">
									<a class="nav-link" href="login.php">Login</a>
								</li>
								<li class="nav-item mr-5">
									<a class="nav-link" href="register.php">Register</a>
								</li>';
					}
				?>
					
				</ul>
			</div>
		</nav>

		<div style=" margin: 0 auto; display: flex; align-items: center; flex-direction: column;">
			<div style="margin: 20px;"><h4>Upload a new image!</h4></div>
			<form method="POST" action="uploadimage.php" enctype="multipart/form-data">
				<div class="form-group">
					<div class="custom-file mb-2">
						<input type="file" class="custom-file-input" id="image" name="image" required>
						<label class="custom-file-label" for="image" id="imglabel">Choose image...</label>
					</div>
					<div class="mb-2">
						<textarea class="form-control" id="validationTextarea" placeholder="Say something about this image..." name="description" required></textarea>
					</div>
				</div>
				<div style="display: flex; justify-content: flex-end;">
					<button type="submit" class="btn btn-primary" name="upload">Post!</button>
				</div>
			</form>
			<script>
            $('#image').on('change',function(){
                //get the file name
                var fileName = $(this).val().replace(/.*\//, '').replace(/.*\\/, '');;;
                //replace the "Choose a file" label
                $(this).next('.custom-file-label').html(fileName);
            })
        </script>
		</div>
		<hr>
		<div style="width: 80%; margin: 0 auto; display: flex; align-items: center; flex-direction: column;">
			<?php
				$username = $_SESSION['user'];
				$link = mysqli_connect("127.0.0.1", "root", "", "first_db");
				$query = mysqli_query($link, "Select * from images ORDER BY id DESC"); // SQL Query
				if(mysqli_num_rows($query) != 0){
					Print '<h4>Your uploads</h4>';
					while ($row = mysqli_fetch_array($query)) {
						Print '<div class="card" style="width: 24rem; margin: 10px; background-color: dark-gray;">';
							Print '<img src="images/'.$username.'/'.$row["image"].'" class="card-img-top">';
							Print '<div class="card-body">';
								Print '<p class="card-text">'.$row["description"].'</p>';
							Print '</div>';
						Print '</div>';
						}
				}
				else {
					Print '<h4>You haven\'t uploaded any images yet :(</h4>';
				}
			?>
		</div>
	</body>
</html>